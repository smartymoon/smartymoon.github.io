<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>网络协议学习总结（一） | 厉增伟博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="网络协议是很抽象又很重要的内容，不结合具体的实例很难去理解他。之前学过很多次，都是一知半解，过不了多久就忘记了，只隐约记得 OSI 七层协议而已。这几天使用了新的工具，对网络协议的要求很高，故又学了一遍，做些笔记，希望不要再忘记。">
<meta property="og:type" content="article">
<meta property="og:title" content="网络协议学习总结（一）">
<meta property="og:url" content="https://tt12t.com/2019/11/27/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89/index.html">
<meta property="og:site_name" content="厉增伟博客">
<meta property="og:description" content="网络协议是很抽象又很重要的内容，不结合具体的实例很难去理解他。之前学过很多次，都是一知半解，过不了多久就忘记了，只隐约记得 OSI 七层协议而已。这几天使用了新的工具，对网络协议的要求很高，故又学了一遍，做些笔记，希望不要再忘记。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://static.tt12t.com/frame_sample_for_mac.png">
<meta property="og:image" content="https://static.tt12t.com/zhidao_mac_quan_kao_hong.png">
<meta property="og:image" content="https://static.tt12t.com/hub_web_function_thero.png">
<meta property="og:image" content="https://static.tt12t.com/switch_function_theres.png">
<meta property="og:image" content="https://static.tt12t.com/jiandan_luyou_qingkuang.png">
<meta property="article:published_time" content="2019-11-27T02:58:24.000Z">
<meta property="article:modified_time" content="2020-09-11T12:08:53.950Z">
<meta property="article:author" content="厉增伟">
<meta property="article:tag" content="网络协议">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://static.tt12t.com/frame_sample_for_mac.png">
  
    <link rel="alternate" href="/atom.xml" title="厉增伟博客" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">厉增伟博客</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://tt12t.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-网络协议学习总结（一）" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/11/27/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89/" class="article-date">
  <time datetime="2019-11-27T02:58:24.000Z" itemprop="datePublished">2019-11-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      网络协议学习总结（一）
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>网络协议是很抽象又很重要的内容，不结合具体的实例很难去理解他。之前学过很多次，都是一知半解，过不了多久就忘记了，只隐约记得 OSI 七层协议而已。这几天使用了新的工具，对网络协议的要求很高，故又学了一遍，做些笔记，希望不要再忘记。</p>
<a id="more"></a>

<p>从网络范围由小到大进行讨论          </p>
<h2 id="一个屋中的两个电脑"><a href="#一个屋中的两个电脑" class="headerlink" title="一个屋中的两个电脑"></a>一个屋中的两个电脑</h2><p>（此部分内容为假象，没有实际实验过，后期实验）<br>两台电脑进行通讯，用一根网线链接两个口，两个口的后面就是两张网卡，每个网卡都有一个唯一的地址叫 <code>MAC地址</code>，它是在网络设备间最常用的地址，当确定了 <code>MAC地址</code> 就可以像目标发送消息了，就像在小屋子内，互相写信，要写上发信人是谁，收信人是谁，就不会造成发错对象，或是理解错发信人这种怪事。<code>MAC地址</code> 可以理解为邻近设备互相沟通的依据。</p>
<p>信息的发送是一个一个包来实现的，每天个包的体积不会很大，有时被称为帧 <code>Frame</code>，这样就不会造成拥堵。在每个包的最开头就是 <code>MAC地址</code></p>
<p><img src="https://static.tt12t.com/frame_sample_for_mac.png"></p>
<p>可以很明显得看到，数据包最前面的部分就是两个 <code>MAC地址</code>，一个是我本机的地址，一个是目标机器的地址。在我们配置电脑的网络的时候，需要手动配置四样东西：IP 地址，网关，子网掩码，DNS。这其中并没有 <code>MAC地址</code>，那我们的电脑是如何知道对方主机的 <code>MAC地址</code> 的呢，这个方法说白了就是吼，叫做 <code>ARP</code> 协议。</p>
<p>“谁是 192.168.77.14啊，知道的说吱一声，我是 192.168.99.121”</p>
<p><img src="https://static.tt12t.com/zhidao_mac_quan_kao_hong.png"></p>
<p>图中的包的就是一个 <code>ARP</code> 包，它的作用就是问 <code>MAC地址的</code> 因为是广播，没有具体目标，所以目标 <code>MAC地址</code> 就写成了 <code>ff ff ff ff ff ff</code>，无关人等看到这条消息就忽略它，匹配上IP的机器，就把自己的 <code>MAC地址</code> 回复给发问的机器，这样源机器就知道了想要通话的机器的 <code>MAC地址</code> 了，接下来就可以发真正想发的内容了。</p>
<p>在两台机器直连的情况下，首先配置好各个的 IP 地址，在 A 机器向 B 机器说话的过程中，因为没有对方的 <code>MAC地址</code> 所以先吼一下，也就是 <code>ARP</code>，因为只有一根网线，B机器就收到了这个消息，在 B 机器的 IP 没有配置错的情况下，确认了想沟通的对象是自己，于是返回自己的 <code>MAC地址</code>，从此这两台电脑就可以联机游戏了。</p>
<h2 id="三台电脑"><a href="#三台电脑" class="headerlink" title="三台电脑"></a>三台电脑</h2><p>三台电脑的情况下怎么办，线只有两头，只靠网线没有办法联三台电脑。这个时候我们有两种办法，第一种是方法是使用: 集线器。这是个纯物理设备，价格最便宜，网上已经找不到了。它的上面可以连出三根或更多网线，然后单纯地把它们联在一起，就像有三个头的网线</p>
<p><img src="https://static.tt12t.com/hub_web_function_thero.png"> </p>
<center>集线器示意图</center>

<p>可以看出这种办法是有效的，但是很浪费，去网 C 的信号完全是无意义并且浪费的，当设备一多，就会造成七嘴八舌的情况，网络就会变得拥堵，所以淘宝上已经找不到这个设备了。</p>
<p>优化他的办法也很简单，让集线器知道，连接到它的设备都是谁， 每条线路对应的 <code>MAC地址</code> 都是什么就可以了，当有信号进来的时候，看看这个信号的目标 <code>MAC地址</code> ，然后只让它对应的那条线走就可以了，这个升级后的设备叫交换机。</p>
<p><img src="https://static.tt12t.com/switch_function_theres.png"></p>
<center>交换机示意图</center>

<p>那么当 <code>ARP</code> 信号经过的时候怎么办，简单，交换机向所有其它口广播消息，当回复信号再次经过它的时候，通过读这个信号中的信息，它就掌握了，这个口对应的 <code>MAC地址</code>，完成了学习</p>
<h2 id="想让隔壁省的电脑也连进来怎么办"><a href="#想让隔壁省的电脑也连进来怎么办" class="headerlink" title="想让隔壁省的电脑也连进来怎么办"></a>想让隔壁省的电脑也连进来怎么办</h2><p>同学在隔壁省，想一起玩游戏，从隔壁省拉根网线到我的电脑上是不现实的。这个时候就要用到互联网，我和他都交个网费，都是联通的吧，一年600块。然后运营商就会给我们两家一人一根可以联网的网线，我们这里假设这两条网的 IP 地址都是固定的。我家 IP 是 118.118.118.118,小明家 IP 是 119.119.119.119，并且不考虑家用路由器。</p>
<p><img src="https://static.tt12t.com/jiandan_luyou_qingkuang.png"></p>
<p>这个时候仅靠 <code>MAC 地址</code> 不行了，就像在山东吼一声: “谁的身份证是 119.119.119.119”,这个人如果在自己家里可能还得到回应，可这个人在隔壁省，路途太遥远了，总不能让两个省的设备都接收你的 <code>ARP</code> 请求，那网络该乱成什么样子。</p>
<p>这个时候 IP 就要发挥作用了，首先讲讲网关。网关的作用可以理解为一家人，一家人之间，我们互相吼一吼，直接问对方 <code>MAC 地址</code> 是没什么问题的。出了家门，就不能乱吼了，否则整个小区的人都会出来揍人，还未必找得到人，如同大海捞针。当我们用电脑发送一个信息的时候，首先要确认的就是接收者是不是我们家人，是的化就吼，不是的话就交给邮局，剩下的事就不管了。如何确定一家人呢，要综合看 IP 地址和子网掩码。</p>
<h3 id="IP-地址"><a href="#IP-地址" class="headerlink" title="IP 地址"></a>IP 地址</h3><p>IP 地址有四段，形如 <code>192.168.1.1</code> , 其中每个段的范围是 0 ~ 254。在 IP 地址中找出自己家人，剩下的就是外网的人了。有的家族小，分配的成员少一点就够了，有的家族大，分配的成员要多一点，那如何分配，就要看子网掩码了。</p>
<h3 id="子网掩码"><a href="#子网掩码" class="headerlink" title="子网掩码"></a>子网掩码</h3><p>它的二进制形式是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A： 11111111 00000000 00000000 00000000</span><br><span class="line">B： 11111111 11111111 00000000 00000000	</span><br><span class="line">C:  11111111 11111111 11111111 00000000</span><br></pre></td></tr></table></figure>
<p>和 IP 地址一样，也是四段的，它的特点是前面一堆全是 1，后面一堆全是 0。常见的 IP 地址和子网掩码的组合如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">  IP: 192.168.1  .1</span><br><span class="line">掩码：255.255.255.0</span><br><span class="line">&#x2F;&#x2F; 换成二进制</span><br><span class="line">  IP: 11000000 10101000 00000001 00000001</span><br><span class="line">掩码: 11111111 11111111 11111111 00000000</span><br></pre></td></tr></table></figure>
<p>IP 和 掩码上下对应着位置来看，对于两个 IP 地址，如果掩码中 1 对应的位置都是相同的，那么它们就在同一个网段。换成10进制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.0  到 192.168.1.254 都是一家人</span><br></pre></td></tr></table></figure>
<p>其中有一个成员我们会把它定义成网关，也就是家里的大门，把数据给他就相当于给了邮局<br>通常它的一家人中的第一个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.1.1 我是网关，看门人</span><br></pre></td></tr></table></figure>

<p>回到最开始和小明联机的情景中来，当联通的网线接进来的时候，我们是直接把它连在电脑上的，我们的电脑的 IP 就是联通给分配的 IP，子网掩码是 <code>255.255.255.255</code>, 网关就是它自己，信息进入小区的路由器后，小区的路由器会根据目的 IP 选择下一级路由，进入下一跳，直到小明的小区的路由器，那个路由器一看数据是给小明的，就直接传给小明家的电脑了，至些完成了信息传送。信息在路由器中传递的时候，头部的两个 <code>MAC 地址</code> 会依次被替换成当前路由和下一跳路由的 IP 地址。</p>
<p>现在我们将情况变得复杂一点，能常情况下，家里都不会入户网线直连电脑的，都要整个<br>家用路由器（家用路由器和严格意义上的路由器有很大区别），这样电脑和手机都可以上网了。这个时候拨号操作就不是由电脑来实现的了，而是由家用路由器实现。我们电脑的 IP 地址也不是公网 IP 地址了，而是家用路由器给分配的一个内网地址。通常是 <code>192.168.1.x</code>, 至于它们如何通信，除了利用第三方服务器，我还没想到什么办法。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://tt12t.com/2019/11/27/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89/" data-id="ckey7od8o000m5fqoby7ne6nb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">网络协议</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/11/28/%E7%BC%96%E7%A8%8B%E5%91%BD%E5%90%8D%E6%8A%80%E5%B7%A7/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          编程命名技巧
        
      </div>
    </a>
  
  
    <a href="/2019/07/27/%E7%BB%83%E5%AD%97%E7%AC%AC%E4%B8%80%E5%A4%A9-%E7%82%B9%E7%9A%84%E5%BF%83%E5%BE%97/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">练字第一天, 点的心得</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/" rel="tag">python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%89%AF%E6%B7%A1/" rel="tag">扯淡</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8A%80%E5%B7%A7/" rel="tag">技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" rel="tag">网络协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" rel="tag">读后感</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/%E6%89%AF%E6%B7%A1/" style="font-size: 10px;">扯淡</a> <a href="/tags/%E6%8A%80%E5%B7%A7/" style="font-size: 10px;">技巧</a> <a href="/tags/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/" style="font-size: 15px;">网络协议</a> <a href="/tags/%E8%AF%BB%E5%90%8E%E6%84%9F/" style="font-size: 20px;">读后感</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/12/14/linux%E7%94%A8%E8%BF%87%E7%9A%84%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/">linux用过的命令总结</a>
          </li>
        
          <li>
            <a href="/2019/11/28/hostOnly-and-nat/">VirtualBox 虚拟机的 HostOnly 与 NAT 模式的原理</a>
          </li>
        
          <li>
            <a href="/2019/11/28/%E7%BC%96%E7%A8%8B%E5%91%BD%E5%90%8D%E6%8A%80%E5%B7%A7/">编程命名技巧</a>
          </li>
        
          <li>
            <a href="/2019/11/27/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93%EF%BC%88%E4%B8%80%EF%BC%89/">网络协议学习总结（一）</a>
          </li>
        
          <li>
            <a href="/2019/07/27/%E7%BB%83%E5%AD%97%E7%AC%AC%E4%B8%80%E5%A4%A9-%E7%82%B9%E7%9A%84%E5%BF%83%E5%BE%97/">练字第一天, 点的心得</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 厉增伟<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>